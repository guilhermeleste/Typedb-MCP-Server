---
applyTo: "src/**"
---

# Source Code Instructions

## Rust Code Standards
- Use explicit error handling with `?` operator or `match` statements
- Never use `unwrap()` or `expect()` in production code
- All public items require comprehensive Rustdoc documentation with examples
- Follow async patterns: use `tokio` runtime, proper future handling

## Module Organization
- Business logic belongs in appropriate submódules, not in `McpServiceHandler`
- MCP tools are organized in `src/tools/` submódules: `db_admin`, `query`, `schema_ops`, `params`
- Each module has a clear single responsibility
- Use `pub use` for clean public APIs

## TypeDB Integration
- Always use connection pooling for TypeDB connections
- Parameterize TypeQL queries to prevent injection
- Handle TypeDB-specific errors with proper conversion to `ErrorData`
- Use transactions appropriately for data consistency

## Error Handling
- Convert all internal errors to `ErrorData` with specific implementations
- Provide meaningful error messages for clients
- Use structured error types with proper context
- Never expose internal system details in error responses

## MCP Compliance
- Tool parameters use descriptive domain names (`db_name`, `typeql_query`)
- Validate all MCP tool inputs using `tools::params` module
- Follow JSON-RPC 2.0 specification strictly
- Implement proper authentication and authorization checks

## Performance & Security
- Use efficient iterators for collections
- Implement proper resource cleanup in Drop traits
- Add tracing spans for observability
- Validate all user inputs at boundary layers
